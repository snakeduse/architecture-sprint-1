# Спринт 1

## Задание 1

*Примечание. Задание 1 выполнено в рамках первых двух пунктов и представляет собой концепцию перехода приложения Mesto на микрофронтенды. Проект не содержит в себе код, готовый к запуску и выполнению.*

Команда приложения Mesto представляет собой группу React разработчиков, поэтому было принято решение в качестве основной технологии использовать фреймворк React.

В приложении Mesto выделяются следующие предметные области:

- Аутентификация;
- Профили пользователя;
- Карточки фотографий.

Каждой предметной области соответствует свое микрофронтенд-приложение:

- `auth` - Приложение аутентификации.  
Данное микрофронтенд-приложение содержит компоненты и логику работы со входом в приложение Mesto (signin) и выходом из приложения Mesto (signout), наполнением общего состояния о данных пользователя, пошедшего в систему. Так же реализует технологию сокрытия компонентов, если пользователь попытается работать с приложением, не осуществив вход (signin).  
Приложение так же содержит в себе модуль для выполнения запросов к REST API аутентификации;
- `profile` - Приложение для работы с профилями пользователей.  
Данное микрофронтенд-приложение содержит набор компонентов для работы с профилями пользователя.  
Приложение так же содержит в себе модуль для выполнения запросов к REST API профилей пользователя;
- `cards` - Приложение для работы с карточками фотографий.  
Данное микрофронтенд-приложение содержит компоненты для работы с карточками фотографий пользователя.  
Приложение так же содержит в себе модуль для выполнения запросов к REST API фотографий пользователя.

Дополнительно выделены следующие микрофронтенд-приложения:

- `host` - Основное приложение, которое объединяет в себе другие микрофронтенд-приложения. Данное приложение содержит каркас приложения Mesto и агрегирует в себе другие микрофронтенд-приложения;
- `lib` - Библиотека общих компонентами. Приложение предоставляет общие компоненты для других микрофронтенд-приложений.

Микрофронтенд-приложения располагаются в директории `/frontend/microfrontend`. Для наглядности оставлена и текущая монолитная реализация приложения Mesto.

Такой набор микрофронтенд-приложений позволяет:

- Независимо развивать разные части приложения Mesto разными командами разработки;
- Изолированно менять разные части приложения Mesto, уменьшая вероятность случайной поломки одних частей при изменении других;
- Персонально масштабировать каждое микрофронтенд-приложения при увеличении нагрузки;
- Проводить частые и независимые обновления микрофронтенд-приложений;
- Тестировать независимо каждое микрофронтенд-приложение;
- Развивать и усложнять интерфейс приложения Mesto.

В качестве инструмента композиции был выбран Webpack Module Federation. Это позволит создать динамическое и отзывчивое приложение. Т.к. в компании используется одна технология React, Module Federation так же позволит разделять общие компоненты между микрофронтенд-приложениями.

Некоторые микрофронтенд-приложения используют совместные данные. Приложение Mesto находится на раннем этапе развития и не требует сложных технологий управления состоянием, поэтому для начальных версий приложения для реализации общего состояния была выбрана технология React Context. В дальнейшем, по мере усложнения состояния приложения Mesto, планируется переход на библиотеку глобального состояния Redux. Технология Redux - это мощный инструмент управления общим состоянием, который позволит удовлетворить сложные требования к управлению состояния, в том числе, когда начнут появляться сложные иерархические состояния. Помимо этого Redux позволит реализовать паттерн `Observable state`, давая возможность компонентам подписываться на изменения состояния и реагировать при изменении состояния, что в свою очередь может привести к снижению связанности некоторых микрофронтенд-приложений между собой.

В будущем так же предполагается использование паттерна `Backend For Frontend` (BFF), что позволит масштабировать нагрузку точечно для каждого микрофронтенд-приложения и даст возможность сохранить простой REST API для конкретных микрофронтенд-приложений при параллельном развитии и усложнении серверной стороны (backend), когда серверная сторона будет переходить на микросервисную архитектуру и развивать ее.
Дополнительно BFF позволит предоставлять предварительно сгенерированную HTML-страницу содержащую необходимую информацию для SEO.

### Структура проекта

Ниже представлена общая структура микрофронтенд-приложения:

- `src` - Директория с исходным кодом;
- `src/blocks` - Директория с CSS-стилями;
- `src/components` - Директория содержит компоненты React;
- `src/utils` - Директория содержит вспомогательные утилиты и модули;
- `webpack.config.js` - Конфигурация Webpack.

В зависимости от микрофронтенд-приложения, некоторые компоненты могут быть опущены или расширены.

Отдельно стоит описать структуру общей библиотеки `lib`:

- `src` - Директория с исходным кодом;
- `src/blocks` - Директория с CSS-стилями общих компонентов React;
- `src/components` - Директория содержит общие компоненты React;
- `src/context` - Директория содержит общий контекст, который используется другими микрофронтенд-приложениями для работы с общим состоянием.

## Задание 2

*Примечание. Автор выполнения задания 2 не имеет опыта работы с электронными торговыми площадками и слабо представляет их модель работы. Поэтому задание 2 было выполнено в контекстен информации, представленной на оригинальной схеме draw.io на странице "DF".*

Задание 2 оформлено в файле [arch_template_task2.drawio](arch_template_task2.drawio) на странице "Home Work".
Приложение выделяет следующие компоненты:

- **Портал электронной площадки** - Веб-приложение, с которым работают пользователи. Приложение из себя представляет монолитное фронтенд-приложение, имеющее единый REST API интерфейс. Приложение предоставляет следующие функции:
  - Аутентификация пользователей;
  - Регистрация на площадке;
  - Редактирование профиля пользователя;
  - Размещение заказов;
  - Работа с аукционами;
  - Размещение услуг;
  - Отображение уведомлений;
  - Настройка системы оплаты;
- **Система управления торговыми площадками** - Приложение управления торговыми площадками (далее сервер). Приложение представляет собой набор микросервисов и компонентов. Выделяются следующие микросервисы и компоненты:
  - **API Gateway** - API шлюз для предоставления единой точки взаимодействия с сервером, проводит аутентификацию клиентов, как по логину паролю, так и по JWT токену. API шлюз выполняет маршрутизацию запросов конечным микросервисам. Так же API шлюз предоставляет возможность подписываться на события. В качестве протокола доставки событий был выбран Server-Sent Events (SSE). Протокол SSE поддерживается, как браузерами, так и имеет реализацию клиентов SSE для разных языков программирования;
  - **Сервис аутентификации** - Сервис выполняет:  
    - Аутентификацию пользователей по логину и паролю пользователя;
    - Проверку JWT-токена;  
    - Выдачу новых JWT-токенов на основании логина и пароля пользователя и на основании токена обновления (refresh token);
    - Выдачу токенов обновления (refresh token).  
    Токены обновления используются для перевыпуска JWT-токена с истекшим временем жизни без ввода логина и пароля на стороне веб-приложения.  
  - **Сервис пользователей** - Сервис, который работает с данными пользователя, включая присвоение ролей доступа. Сервис генерирует события о новых пользователях;
  - **Сервис заказов** - Сервис управляет заказами, генерирует отчеты продаж и инкапсулирует в себе взаимодействие с сервисом оплат. На текущем этапе работа с заказами может включать в себя взаимодействие только с одним сервисом оплат, поэтому нет необходимость в выделении алгоритма работы с заказом и оплаты в отдельную роль оркестратора. Сервис генерирует события об изменении состояния заказов;
  - **Сервис аукционов** - Сервис предоставляет работу с аукционами. Сервис генерирует события об изменениях в аукционах;
  - **Сервис товаров и услуг** - Сервис представляет работу с товарами и услугами, привязывать пользователя к услуге или товару;
  - **Сервис уведомлений** - Сервис публикует уведомления об изменениях в торговых площадках;
  - **Сервис технической поддержки** - Сервис предоставляет возможность работы с заявками технической поддержки.
  - **Сервис оплаты** - Сервис инкапсулирует в себе работу с разными системами оплаты и предоставляет возможность проведения оплат. Так же сервис позволяет настроить систему оплаты для конкретного пользователя.

Общение между микросервисами основано на протоколе HTTP/1.1. Формат взаимодействия JSON.  
В качестве шины событий используется `Apache Kafka`, которая хранит события системы и с которой работает сервис уведомления, отправляя события конечному пользователю.
